FROM {{ base_image }}

RUN git -c advice.detachedHead=false checkout {{ environment_setup_commit }}

{% if path_to_env_file %}
COPY {{ path_to_env_file }} .
{% endif %}

RUN {{conda_create_cmd}}

SHELL ["conda", "run", "-n", "{{ testbed }}", "/bin/bash", "-c"]

{% if path_to_reqs %}
COPY {{ path_to_reqs }} .
{% endif %}

{% for cmd in install_cmds %}
RUN {{ cmd }}
{% endfor %}

ENV TESTBED_NAME={{ testbed }}

WORKDIR /home/swe-bench

ENTRYPOINT ["./entrypoint.sh"]
